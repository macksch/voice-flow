<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; connect-src 'self';">
    <title>VoiceFlow Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div>
            <div class="logo">
                <div class="logo-icon">
                    <img src="../assets/icons/dashboard-logo.png"
                        style="width: 100%; height: 100%; object-fit: contain;">
                </div>
                <div class="logo-text">Voiceflow</div>
            </div>

            <nav>
                <div class="nav-item active" data-tab="home">
                    <span>üìä</span> Dashboard
                </div>
                <div class="nav-item" data-tab="modes">
                    <span>‚ú®</span> Modi
                </div>
                <div class="nav-item" data-tab="history">
                    <span>üïí</span> Historie
                </div>
                <div class="nav-item" data-tab="settings">
                    <span>‚öôÔ∏è</span> Einstellungen
                </div>
            </nav>
        </div>

        <div class="api-status">
            <div class="status-dot"></div>
            <span>Groq API Verbunden</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">

        <!-- Header (Shared) -->
        <div class="top-bar">
            <div class="header">
                <h1 id="page-title">Willkommen zur√ºck</h1>
                <p id="page-subtitle">Verwalte deine VoiceFlow Sprachverarbeitung.</p>
            </div>
            <div class="user-actions">
                <button class="icon-btn" id="btn-notifications">üîî</button>
                <div class="avatar" id="user-avatar">VF</div>
            </div>
        </div>

        <!-- VIEW: Home / Dashboard -->
        <div id="view-home" class="view">
            <!-- Top Row: Stats & Active Mode -->
            <div class="dashboard-top-row">
                <!-- Stats Container -->
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon-wrapper icon-mic">üé§</div>
                            <span class="stat-change positive">+12%</span>
                        </div>
                        <div class="stat-label">Gesamt-Aufnahmen</div>
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-progress">
                            <div class="stat-progress-bar" style="width: 45%; background: var(--accent);"></div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon-wrapper icon-text">üìÑ</div>
                            <span class="stat-change positive">+5%</span>
                        </div>
                        <div class="stat-label">Zeichen verarbeitet</div>
                        <div class="stat-value" id="stat-words">0</div>
                        <div class="stat-progress">
                            <div class="stat-progress-bar" style="width: 70%; background: #9d4edd;"></div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon-wrapper icon-time">‚è±Ô∏è</div>
                            <span class="stat-change negative">-2%</span>
                        </div>
                        <div class="stat-label">Zeit gespart</div>
                        <div class="stat-value" id="stat-time">0m</div>
                        <div class="stat-progress">
                            <div class="stat-progress-bar" style="width: 60%; background: #ff9100;"></div>
                        </div>
                    </div>
                </div>

                <!-- Active Mode Card -->
                <div class="active-mode-card">
                    <div class="am-icon">‚ö°</div>
                    <div class="am-label">AKTIVER MODUS</div>
                    <div class="am-value" id="dashboard-active-mode">Standard</div>
                    <button class="btn-light" onclick="document.querySelector('[data-tab=modes]').click()">Modus
                        √§ndern</button>
                </div>
            </div>

            <!-- Activity Table Section -->
            <div class="activity-section">
                <div class="section-header">
                    <h2>Aktivit√§tsverlauf</h2>
                    <div class="section-actions">
                        <select class="dropdown-select">
                            <option>Letzte 7 Tage</option>
                        </select>
                        <button class="btn-primary-small" onclick="window.electron.toggleRecording()">+ Neue
                            Aufnahme</button>
                    </div>
                </div>

                <div class="table-wrapper">
                    <table class="activity-table">
                        <thead>
                            <tr>
                                <th>STATUS</th>
                                <th>TRANSKRIPTION</th>
                                <th>DATUM & ZEIT</th>
                                <th>L√ÑNGE</th>
                                <th>AKTIONEN</th>
                            </tr>
                        </thead>
                        <tbody id="activity-table-body">
                            <!-- Rows injected by JS -->
                        </tbody>
                    </table>
                </div>
                <!-- Pagination / Footer if needed -->
                <div class="table-footer" id="activity-table-footer">
                    <div class="pagination-info">
                        Zeige <span id="activity-count">0</span> von <span id="total-count">0</span> Transkriptionen
                    </div>
                    <div class="pagination-btns">
                        <button class="btn-icon-small" disabled title="Vorseite">‚ùÆ‚ùÆ</button>
                        <button class="btn-icon-small" disabled title="N√§chste Seite">‚ùØ‚ùØ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: Stats REMOVED -->

        <!-- VIEW: Modes Editor -->
        <div id="view-modes" class="view hidden">
            <div class="mode-editor-container">

                <!-- Left: List -->
                <div class="mode-list-panel">
                    <button class="btn-create" id="btn-create-mode-view">+ Neuen Modus erstellen</button>
                    <div style="display:flex; gap:8px; margin-bottom:12px;">
                        <button class="btn-secondary" id="btn-export-modes"
                            style="flex:1; font-size:11px; padding:8px;">‚¨á Exportieren</button>
                        <button class="btn-secondary" id="btn-import-modes"
                            style="flex:1; font-size:11px; padding:8px;">‚¨Ü Importieren</button>
                    </div>
                    <input type="file" id="file-import-modes" accept=".json" style="display:none;">

                    <div id="mode-list-container">
                        <!-- Mode Items injected here -->
                    </div>
                </div>

                <!-- Right: Details -->
                <div class="mode-detail-panel" id="mode-detail-panel">
                    <div class="editor-header">
                        <h2>Modus bearbeiten</h2>
                        <div class="mode-actions-top">
                            <span id="editor-active-indicator" class="active-indicator hidden">‚óè Aktiv</span>
                            <button id="btn-set-active" class="btn-secondary">Als Aktiv setzen</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Modus-Name</label>
                        <input type="text" id="edit-name" class="input-field">
                    </div>

                    <div class="form-group">
                        <label>Symbol</label>
                        <div id="icon-picker" class="icon-grid">
                            <!-- Icons injected by JS -->
                        </div>
                        <input type="hidden" id="edit-icon">
                    </div>

                    <div class="form-group">
                        <label>Transformationsregeln</label>
                        <small class="editor-hint">
                            ‚ÑπÔ∏è Ein Sicherheits-Pr√§fix wird automatisch erg√§nzt,
                            der verhindert, dass das LLM Fragen beantwortet.
                        </small>
                        <textarea id="edit-prompt" class="input-field" rows="8"></textarea>
                    </div>

                    <div style="display:flex; justify-content: space-between; margin-top: 32px;">
                        <button class="btn-danger hidden" id="btn-delete-mode">Modus l√∂schen</button>
                        <div style="display:flex; gap: 12px; margin-left: auto;">
                            <button class="btn-secondary" id="btn-cancel-edit">Abbrechen</button>
                            <button class="btn-create" style="width: auto; margin-bottom:0;"
                                id="btn-save-edit">Speichern</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- VIEW: History -->
        <div id="view-history" class="view hidden">
            <div class="history-controls">
                <input type="text" placeholder="Transkripte durchsuchen..." class="search-input" id="history-search">
                <button class="btn-create" style="width: auto;" id="btn-start-rec-action">üéôÔ∏è Neue Aufnahme
                    starten</button>
            </div>

            <div id="history-feed">
                <!-- Cards injected here -->
            </div>
        </div>

        <!-- VIEW: Settings -->
        <div id="view-settings" class="view hidden">
            <h2 class="view-title">Einstellungen</h2>
            <div class="settings-layout">

                <!-- Sec: API & Sicherheit -->
                <div class="setting-card">
                    <div class="setting-header">
                        <span class="setting-icon">üîë</span> API & Sicherheit
                    </div>
                    <div class="setting-body">
                        <div class="form-group">
                            <label>Groq API Key</label>
                            <div class="input-wrapper">
                                <input type="password" id="api-key-input" class="input-field" placeholder="gsk_...">
                                <button class="btn-icon-inside" id="toggle-api-visibility">üëÅÔ∏è</button>
                            </div>
                            <small class="hint">Wird lokal verschl√ºsselt gespeichert.</small>
                        </div>
                    </div>
                </div>

                <!-- Sec: Hardware & Eingabe -->
                <div class="setting-card">
                    <div class="setting-header">
                        <span class="setting-icon">üéôÔ∏è</span> Hardware & Eingabe
                    </div>
                    <div class="setting-body">
                        <div class="form-group">
                            <label>Mikrofon</label>
                            <select id="audio-device-select" class="input-field"></select>
                        </div>
                        <div class="form-group">
                            <label>Globaler Hotkey</label>
                            <div class="input-wrapper">
                                <input type="text" id="hotkey-input" class="input-field" readonly>
                                <button class="btn-secondary small"
                                    style="position:absolute; right:8px; top:4px;">√Ñndern</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Deine Initialen (Avatar)</label>
                            <input type="text" id="user-initials-input" class="input-field" maxlength="2"
                                placeholder="VF" style="width: 80px; text-transform: uppercase; text-align: center;">
                        </div>
                    </div>
                </div>

                <!-- Sec: Sprache & KI -->
                <div class="setting-card">
                    <div class="setting-header">
                        <span class="setting-icon">üß†</span> Sprache & KI-Modelle
                    </div>
                    <div class="setting-body">
                        <div class="form-group">
                            <label>Sprache (Transkription)</label>
                            <select id="languageSelect" class="input-field">
                                <option value="auto">Automatisch (Erkennen)</option>
                                <option value="de">Deutsch (de)</option>
                                <option value="en">Englisch (en)</option>
                                <option value="fr">Franz√∂sisch (fr)</option>
                                <option value="es">Spanisch (es)</option>
                                <option value="it">Italienisch (it)</option>
                                <option value="nl">Niederl√§ndisch (nl)</option>
                                <option value="pt">Portugiesisch (pt)</option>
                                <option value="ru">Russisch (ru)</option>
                                <option value="ja">Japanisch (ja)</option>
                                <option value="zh">Chinesisch (zh)</option>
                            </select>
                        </div>

                        <div class="setting-group-inline">
                            <div class="form-group half">
                                <label>Spracherkennung</label>
                                <select id="model-transcription" class="input-field">
                                    <option value="whisper-large-v3">Whisper Large V3</option>
                                    <option value="whisper-large-v3-turbo">Whisper Large V3 Turbo</option>
                                </select>
                            </div>
                            <div class="form-group half">
                                <label>Textverarbeitung (LLM)</label>
                                <select id="model-llm" class="input-field">
                                    <option value="llama-3.3-70b-versatile">Llama 3.3 70B</option>
                                    <option value="llama-3.1-8b-instant">Llama 3.1 8B</option>
                                    <option value="mixtral-8x7b-32768">Mixtral 8x7B</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sec: W√∂rterbuch -->
                <div class="setting-card">
                    <div class="setting-header">
                        <span class="setting-icon">üìñ</span> W√∂rterbuch
                        <span class="setting-badge" id="dict-count-badge">0 Eintr√§ge</span>
                    </div>
                    <div class="setting-body">
                        <div id="dictionary-list" class="dictionary-list"></div>
                        <div class="add-entry-form">
                            <input type="text" id="dict-spoken" placeholder="Gesprochen (z.B. 'giro')">
                            <input type="text" id="dict-written" placeholder="Geschrieben (z.B. 'JIRA')">
                            <button id="add-dict-btn" class="btn-primary-small">+ Hinzuf√ºgen</button>
                        </div>
                    </div>
                </div>

                <!-- Sec: System -->
                <div class="setting-card">
                    <div class="setting-header">
                        <span class="setting-icon">‚öôÔ∏è</span> System
                    </div>
                    <div class="setting-body">
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="check-autostart">
                                <span>VoiceFlow beim Systemstart starten</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="check-startmin">
                                <span>Minimiert starten (nur Tray)</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="check-autopaste">
                                <span>Text automatisch einf√ºgen (Strg+V)</span>
                            </label>
                        </div>

                        <div class="form-group" style="margin-top:16px;">
                            <label>Overlay Position</label>
                            <select id="overlay-pos-select" class="input-field" style="width:50%;">
                                <option value="bottom-right">Bottom Right</option>
                                <option value="bottom-center">Bottom Center</option>
                                <option value="top-right">Top Right</option>
                                <option value="top-center">Top Center</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Sec: Update -->
                <div class="setting-card">
                    <div class="setting-header">
                        <span class="setting-icon">üîÑ</span> Software Update
                    </div>
                    <div class="setting-body">
                        <div class="update-ui">
                            <div id="update-status">Version wird geladen...</div>
                            <button class="btn-secondary small" id="btn-check-updates">Pr√ºfen</button>
                        </div>
                        <div id="update-progress-bar" class="progress-bar hidden">
                            <div id="update-progress-fill" class="progress-fill"></div>
                        </div>
                        <button class="btn-primary hidden" id="btn-restart-update"
                            style="width:100%; margin-top:12px;">Neustarten & Installieren</button>
                    </div>
                </div>

                <!-- Footer Save -->
                <div class="settings-footer">
                    <button class="btn-create" id="save-settings-btn">Einstellungen speichern</button>
                </div>

            </div>
        </div>

    </div>

    <!-- Tutorial Modal -->
    <div id="tutorial-overlay" class="modal-overlay hidden">
        <div class="modal-content tutorial-modal">

            <!-- Step 1: Welcome & API -->
            <div class="tutorial-step active" data-step="1">
                <div class="tutorial-icon">üëã</div>
                <h2>Willkommen bei VoiceFlow!</h2>
                <p>Damit du direkt loslegen kannst, brauchen wir nur zwei kleine Dinge.</p>

                <div class="tutorial-card">
                    <h3>1. Dein Groq API Key</h3>
                    <p>VoiceFlow wird durch die ultraschnelle Groq AI angetrieben. Hinterlege deinen Key in den
                        Einstellungen, um die Transkription zu aktivieren.</p>
                    <div
                        style="background:var(--bg-input); padding:8px; border-radius:6px; font-family:monospace; font-size:12px; margin-top:8px;">
                        Einstellungen ‚öôÔ∏è ‚Üí Groq API Key
                    </div>
                </div>

                <div class="tutorial-card">
                    <h3>2. Autostart & Hotkeys</h3>
                    <p>Aktiviere "Beim Systemstart starten" in den Einstellungen, damit VoiceFlow immer bereit ist. Das
                        Standard-K√ºrzel ist <code>Alt + Space</code>.</p>
                </div>

                <div class="modal-actions">
                    <button class="btn-create btn-next-step">Weiter</button>
                </div>
            </div>

            <!-- Step 2: Custom Mode Best Practices -->
            <div class="tutorial-step" data-step="2">
                <div class="tutorial-icon">‚ú®</div>
                <h2>Eigene Modi erstellen</h2>
                <p>Das Herzst√ºck von VoiceFlow sind deine eigenen Modi. Hier sind drei Profi-Tipps f√ºr perfekte
                    Ergebnisse:</p>

                <div class="tutorial-tips">
                    <div class="tip-item">
                        <div class="tip-number">1</div>
                        <div class="tip-content">
                            <strong>Sei spezifisch.</strong><br>
                            Schreibe "Du bist ein Senior Java Entwickler" statt nur "Du bist ein Programmierer".
                        </div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-number">2</div>
                        <div class="tip-content">
                            <strong>Definiere das Format.</strong><br>
                            Sage der KI genau, wie der Output aussehen soll (z.B. "Antworte immer als JSON" oder "Nutze
                            Bullet Points").
                        </div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-number">3</div>
                        <div class="tip-content">
                            <strong>Gib Beispiele.</strong><br>
                            Wenn du einen bestimmten Stil willst, f√ºge im Prompt ein kurzes Beispiel hinzu (z.B.
                            "Beispiel: Tonalit√§t: Locker, aber h√∂flich").
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button class="btn-secondary btn-prev-step">Zur√ºck</button>
                    <button class="btn-create btn-next-step">Verstanden</button>
                </div>
            </div>

            <!-- Step 3: Ready -->
            <div class="tutorial-step" data-step="3">
                <div class="tutorial-icon">üöÄ</div>
                <h2>Bereit zum Durchstarten</h2>
                <p>Das war's schon! Du kannst dieses Tutorial sp√§ter jederzeit in den Einstellungen erneut aufrufen.</p>
                <div class="modal-actions">
                    <button class="btn-create btn-finish-tutorial">Los geht's!</button>
                </div>
            </div>

        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <script type="module" src="dashboard.js"></script>
</body>

</html>